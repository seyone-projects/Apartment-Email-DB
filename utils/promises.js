import moment from "moment";
import { sendEMail } from "../constants/mailservices.js";
import { APP_URL } from "../config.js";

export const ValidateObj = (object, schema) => {
  return new Promise((resolve, reject) => {
    const validate = (object, schema) =>
      Object.keys(schema)
        .filter((key) => !schema[key](object[key]))
        .map((key) => new Error(`Required ${key} and must be valid.`));

    const errors = validate(object, schema);

    if (errors.length > 0) {
      for (const { message } of errors) {
        reject({ message: message, status: false });
      }
    } else {
      resolve(true);
    }
  });
};

export const sendUnpaidEmail = async (
  userName,
  userEmail,
  associationName,
  date
) => {
  try {
    var currentDate = moment();
    currentDate.month(moment(date, "YYYY-MM").month());
    currentDate.year(moment(date, "YYYY-MM").year());

    var formattedDate = currentDate.format("DD/MM/YYYY HH:mm");

    const emailContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <title>Society ${associationName} for the ${formattedDate} - Unpaid</title>
            </head>
            <body>
                Hi ${userName},
                <p>Thanks for being part of the society, we noticed that the society dues for the ${formattedDate} seem unpaid. Kindly pay at the earliest to avoid late fee charges.</p>
     
                <br/><br/><p><strong>${APP_URL}/</strong></p>
                <br/>
                <p>Regards,</p>
                <p>Admin<br>${associationName}</p>
            </body>
            </html>
        `;

    const subject = `Society ${associationName} for the ${formattedDate} - Unpaid`;

    const emailData = await sendEMail(subject, userEmail, emailContent);
    return emailData;
  } catch (error) {
    // throw new Error('Error sending email', error);
    console.log("Error sending email", error);
  }
};
 